# 多 AMR 调度系统概览

本项目实现了一个多 AMR（Autonomous Mobile Robot）调度平台，覆盖任务受理、路径规划、协同执行等完整流程。该 README 旨在帮助你快速理解系统结构、核心模块以及关键脚本之间的关系。

## 系统架构

整体架构划分为三层，自上而下分别处理战略决策、战术规划与协同执行：

| 层级 | 主要职责 | 核心算法 | 典型输入输出 |
| --- | --- | --- | --- |
| **战略决策层 (Strategic)** | 决定接收哪些任务并进行初步分配 | ADP / 强化学习、动态查找表 (DLT) | 输入：实时到达的任务；输出：候选任务集合及优先级 |
| **战术规划层 (Tactical)** | 为单台 AMR 生成满足约束的可行路径及充电策略 | 自适应大邻域搜索 (ALNS) | 输入：任务集合、车辆状态；输出：单车路径与充电计划 |
| **协同执行层 (Coordination)** | 解决多车路径冲突，确保整体无碰撞执行 | 基于冲突的搜索 (CBS / ICBS) | 输入：各 AMR 的候选路径；输出：无冲突的最终执行轨迹 |

三层之间的关系可以用以下流程概括：

1. **战略层**接受任务流，依据成本估算器评估收益并决定是否接单。
2. **战术层**获取战略层选择的任务，为每台 AMR 规划路线与补能安排。
3. **协同层**对所有 AMR 的路线进行冲突检测与修正，确保执行顺序安全合理。

需要更直观的结构图时，可参考项目根目录下的 [structure.png](./structure.png)。

## 核心基础模块

这些模块在三层之间复用，为调度算法提供统一的环境建模与模拟能力：

- `src/core/vehicle.py`：定义车辆属性、能耗参数与状态更新逻辑。
- `src/core/route.py`：封装路线表示、节点操作及成本计算接口。
- `src/physics/energy.py`、`src/physics/time.py`：提供能量消耗模型与时间估算方法。
- `src/config/`：集中管理系统默认参数（车辆规格、费用配置、场景预设等）。

## 规划与调度模块

- `src/planner/alns.py`：战术规划核心，实现自适应大邻域搜索、算子调度与充电策略评估。
- `src/planner/fleet.py`：封装多车调度流程，将 ALNS 结果与车辆队列管理结合。
- `src/planner/operators.py`：定义一组可组合的破坏/修复算子，用于探索路径解空间。

## 协调与冲突消解

- `src/planner/cbs/`（若存在）或同类目录：实现基于冲突的搜索算法，负责解决路径冲突。
- 测试入口位于 `tests/warehouse_regression/`，覆盖不同规模场景下的协同调度回归用例。

## 研究创新与基准模型

- **规则库 + RL 选择**：以可解释规则为动作空间，在线调度由规则选择驱动（selection hyper-heuristic）。
- **可学习部分充电**：充电深度离散化，便于稳定学习与策略对照。
- **冲突规避安全屏蔽**：节点/边头距约束+冲突等待惩罚实现 collision-aware（冲突等待 w 汇聚节点/边延迟）。
- **MIP 基准模型**：用于小规模最优/下界对照，详见 `docs/MIP_BASELINE_MODEL.md`。


## 工具与辅助组件

- `src/utils/distance.py`（或等效文件）：提供距离计算与距离缓存，是成本评估、路径规划与冲突检测的基础工具。
- `docs/`：包含算法说明、实验结果或进一步的设计文档。
- `tests/`：单元与集成测试集合，帮助验证模块正确性。

## 如何开始

1. **安装依赖**：请确保创建虚拟环境后安装项目所需依赖（如 `pip install -r requirements.txt`）。
2. **运行测试**：通过 `pytest` 快速验证改动不会破坏现有功能。
3. **调整参数**：所有可调参数集中于 `src/config/defaults.py` 与相关预设文件，便于按需微调。

## 进一步阅读

- [PROJECT_STRUCTURE.md](./PROJECT_STRUCTURE.md)：详细目录结构与模块说明。
- `docs/` 下的专题文档，介绍算法细节与设计考量。
- [MIP 基准模型](./docs/MIP_BASELINE_MODEL.md)：与 RL 规则选择对照的模型化基准。

如果对上述内容仍有疑问，建议结合测试用例阅读代码，以便更好地理解模块间的交互方式。
