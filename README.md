Architecture
┌─────────────────────────────────────────────────────────────┐
│                    多AMR调度系统                              │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ┌───────────────┐  ┌───────────────┐  ┌─────────────────┐ │
│  │  战略决策层    │  │  战术规划层    │  │   协同执行层     │ │
│  │  (Strategic)  │→ │  (Tactical)   │→ │  (Coordination) │ │
│  │               │  │               │  │                 │ │
│  │  • ADP/RL     │  │  • ALNS       │  │  • CBS/ICBS     │ │
│  │  • DLT        │  │  • 单车路径    │  │  • 冲突解决      │ │
│  └───────────────┘  └───────────────┘  └─────────────────┘ │
│         ↑                  ↑                     ↑           │
│         └──────────────────┴─────────────────────┘           │
│                            │                                 │
│                  ┌─────────┴──────────┐                     │
│                  │   核心基础模块       │                     │
│                  │  (Core Modules)    │                     │
│                  └────────────────────┘                     │
└─────────────────────────────────────────────────────────────┘



┌─────────────────────────────────────────────────────────────┐
│                 多AMR调度系统架构                          │
└─────────────────────────────────────────────────────────────┘

                    【任务动态到达】
                           ↓
╔═══════════════════════════════════════════════════════════╗
║  第一层：战略决策层 (Strategic Layer - ADP)                  ║
║  职责：决定"接受哪些任务"                                    ║
╠═══════════════════════════════════════════════════════════╣
║  主要算法：近似动态规划 (ADP) + 动态查找表 (DLT)              ║
║                                                            ║
║  使用 distance.py 吗？ → 间接使用                           ║
║  └─ 需要调用"成本估算器"来快速评估任务价值                   ║
║      成本估算器内部会用 distance.py                          ║
╚═══════════════════════════════════════════════════════════╝
                           ↓
                    【分配任务给AMR】
                           ↓
╔═══════════════════════════════════════════════════════════╗
║  第二层：战术规划层 (Tactical Layer - ALNS)     ← 你说的"第一层" ║
║  职责：为"单个AMR"规划详细路径（包含充电决策）                  ║
╠═══════════════════════════════════════════════════════════╣
║  主要算法：自适应大邻域搜索 (ALNS)                            ║
║                                                            ║
║  使用 distance.py：★★★ 大量使用！                          ║
║  └─ 计算路径总距离                                          ║
║  └─ 找最近的充电站                                          ║
║  └─ 评估插入/移除节点的成本                                  ║
║  └─ 验证pickup在delivery之前                                ║
╚═══════════════════════════════════════════════════════════╝
                           ↓
                  【每个AMR得到一条路径】
                           ↓
╔═══════════════════════════════════════════════════════════╗
║  第三层：协同执行层 (Coordination Layer - CBS)  ← 你说的"第二层"║
║  职责：解决"多个AMR"之间的路径冲突                            ║
╠═══════════════════════════════════════════════════════════╣
║  主要算法：基于冲突的搜索 (CBS/ICBS)                          ║
║                                                            ║
║  使用 distance.py：★★ 中等使用                             ║
║  └─ 检测冲突时需要知道路径长度                               ║
║  └─ 重新规划路径时需要计算距离                               ║
║  └─ 不需要"找充电站"（这是战术层的事）                        ║
╚═══════════════════════════════════════════════════════════╝
                           ↓
                  【无冲突的最终路径】
                           ↓
                    【AMR执行任务】

distance.py: 
工具箱
战略层 （CEO）：需要用成本估算器来快速评估任务价值，成本估算器内部会使用
战术层 （建筑师）：在自适应大领域搜索（ALNS），计算路径总距离，找最近的充电站，评估插入和移除节点的成本，验证pikcup在delivery之前
协同层 （施工队）：使用基于冲突的搜索，检测冲突时需要知道路径的长度，重新规划路径时需要计算距离