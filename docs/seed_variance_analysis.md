# Random Seed Variance Analysis

## 问题：Large Scale性能是否已经修复？

### 用户观察
- seed=2026: Q-learning达到 **38.1%** 改进率
- 认为Large scale性能已经很好

### 当前数据（seed=2025）
根据 `docs/data/alns_regression_results.json`:
- Q-learning: **23.33%**
- Matheuristic: **33.21%**
- 差距: **-9.88%** (Q-learning更差)

### 关键发现：**高度种子依赖性**

| Seed | Q-learning | Matheuristic | Difference |
|------|-----------|-------------|------------|
| 2025 | 23.33%    | 33.21%      | -9.88%     |
| 2026 | 38.1%*    | ?           | ?          |

*用户报告，待验证

## 问题分析

### 1. 为什么会出现如此大的方差？

**可能原因**：

**A. 算法稳定性问题**
- Q-learning的epsilon-greedy策略对初始随机性敏感
- 某些种子可能让算法陷入局部最优
- 某些种子恰好探索到好的算子组合

**B. 问题实例特性**
- 不同种子生成的scenario可能难度不同
- ALNS seed影响初始解质量和搜索轨迹
- 某些实例恰好适合Q-learning的状态划分

**C. 样本量不足**
- **单一种子结果不可靠**
- 需要多个种子的统计平均
- 这正是学术论文要求10-30次运行的原因

### 2. 当前结论

❌ **不能**说"Large scale已经修复"
- seed=2025表现差
- seed=2026表现好
- 这表明算法**不稳定**，不是"修复"

✅ **应该**说"Large scale性能高度依赖种子"
- 需要多种子实验确定真实性能
- 需要降低方差提高鲁棒性

## 解决方案

### 短期（本周）

**1. 多种子实验** ⚡
```bash
python scripts/batch_experiments.py --scales large --seeds 10
```
目标：确定Large scale的**真实平均性能**

**2. 分析方差来源**
- 检查哪些种子表现好/差
- 分析Q-learning在不同种子下的算子选择
- 识别导致失败的模式

### 中期（2周）

**3. 降低方差策略**

**Option A: 调整Q-learning参数**
- 更低的epsilon（减少随机性）
- 更保守的学习率
- 更长的探索阶段

**Option B: 改进状态设计**
- 当前只有3个状态（explore/stuck/deep_stuck）
- 考虑增加状态数量或改进状态特征
- 使状态转换更平滑

**Option C: 集成方法**
- 运行多次取最优（multi-start）
- 集成多个Q-table

### 长期（论文发表）

**4. 在论文中的处理**

**必须**：
- ✅ 报告多种子结果（至少10次）
- ✅ 报告均值和标准差
- ✅ 使用统计检验（t-test）
- ✅ 讨论方差问题

**可选**：
- 分析为什么某些种子表现好
- 提出降低方差的改进方法
- 这可以成为一个研究贡献点

## 实验计划

### Week 1: 验证与理解

**Day 1-2: 多种子实验**
```bash
# 运行10个种子
python scripts/batch_experiments.py --scales small medium large --seeds 10
```

**预期结果**：
- 获得Large scale的真实均值±标准差
- 如果均值>30%，性能可接受
- 如果均值<30%，需要进一步优化

**Day 3-4: 分析种子差异**
```python
# 分析脚本
python scripts/analyze_seed_variance.py
```

分析：
- 好种子vs坏种子的scenario特征
- 好种子vs坏种子的Q-learning行为
- 识别关键差异

### Week 2: 优化与改进

**Day 5-7: 参数调优**
- 基于Week 1的发现调整参数
- 目标：提高均值，降低标准差

**Day 8-10: 验证改进**
- 再次运行10种子实验
- 对比改进前后的方差

## 学术标准

### 顶级期刊要求

**Computers & Operations Research**:
- 至少10-30次运行
- 报告均值、标准差、最小值、最大值
- 统计显著性检验（paired t-test）
- 对比方法也需要多次运行

**示例表格格式**：

| Method | Mean (%) | Std (%) | Min (%) | Max (%) | vs Baseline |
|--------|----------|---------|---------|---------|-------------|
| Matheuristic | 33.2 | 2.1 | 29.5 | 36.8 | - |
| Q-learning | 30.5 | 5.4 | 23.3 | 38.1 | -2.7% (p=0.12) |

**关键点**：
- Q-learning标准差大（5.4% vs 2.1%）→ 不稳定
- 最大值虽好（38.1%）但均值较差（30.5%）
- 统计不显著（p=0.12>0.05）→ 无显著改进

## 结论

### 当前状态评估

**您的观察（seed=2026: 38.1%）**：
✅ 正确 - 确实可能达到这个性能
❌ 但这**不代表**算法普遍性能

**实际情况**：
- Large scale性能**高度不稳定**
- 单一种子结果**不可靠**
- 需要多种子实验确定真实水平

### 接下来的优先级

**P0 (本周)**：
1. 运行10种子完整实验
2. 计算统计指标
3. 确定Large scale真实性能

**P1 (下周)**：
1. 如果均值<30%，需要优化
2. 降低方差（提高鲁棒性）
3. 准备论文所需的统计数据

**P2 (后续)**：
1. 分析方差来源（可能成为论文贡献点）
2. 提出改进方法
3. 与其他方法比较时也用多种子

---

**待办**：
- [ ] 等待batch_experiments.py完成
- [ ] 分析结果并更新此文档
- [ ] 根据结果决定是否需要算法改进
