# ç®—æ³•ä¼˜åŒ–æ–¹æ¡ˆ - è·å¾—æ­£å‘ç»“æœçš„è·¯å¾„

**æ—¥æœŸ**: 2025-11-05
**ç›®æ ‡**: é€šè¿‡ç®—æ³•è®¾è®¡æ”¹è¿›è·å¾—ç»Ÿè®¡æ˜¾è‘—çš„æ­£å‘ç»“æœ
**åˆ†æ”¯**: claude/fix-qlearning-failures-20251103-011CUhJ2dCiVnBt3HEiNW3oY

---

## ğŸ”¬ æ·±åº¦é—®é¢˜è¯Šæ–­

### Seed 2034 Largeå´©æºƒçš„æ ¹æœ¬åŸå› 

**æ•°æ®**:
- Phase 1 (Î±=0.15, stag=0.35): 30.35%
- Phase 1.5 (Î±=0.25, stag=0.22): **4.45%** (å´©æºƒ)

**å¯èƒ½çš„åŸå› åˆ†æ**:

1. **alpha=0.25å¤ªé«˜å¯¼è‡´Qå€¼éœ‡è¡**
   - Largeé—®é¢˜æœç´¢ç©ºé—´å¤§ï¼Œè¿‡é«˜çš„å­¦ä¹ ç‡å¯¼è‡´Qå€¼ä¸ç¨³å®š
   - Q-learningå­¦åˆ°äº†é”™è¯¯çš„æ¨¡å¼å¹¶å¼ºåŒ–
   - é™·å…¥å±€éƒ¨æœ€ä¼˜æ— æ³•é€ƒç¦»

2. **stagnation=0.22å¤ªæ—©è¿›å…¥stuck**
   - è¿‡æ—©æ”¾å¼ƒALNSæ¢ç´¢
   - LPä¿®å¤åœ¨è¿™ä¸ªç‰¹å®šseedä¸Šæ•ˆæœå¾ˆå·®
   - ä¸€æ—¦è¿›å…¥stuckå°±æ— æ³•è¿”å›explore

3. **Seed 2034çš„ç‰¹æ®Šæ€§**
   - è¿™ä¸ªseedç”Ÿæˆçš„é—®é¢˜å¯èƒ½ç‰¹åˆ«éœ€è¦é•¿æ—¶é—´æ¢ç´¢
   - è¿‡æ—©çš„å‚æ•°æ”¶æ•›æ˜¯è‡´å‘½çš„

**ç»“è®º**: Largeè§„æ¨¡éœ€è¦**æ›´ä¿å®ˆ**çš„å‚æ•°ï¼Œè€Œä¸æ˜¯æ›´æ¿€è¿›ï¼

---

### Largeè§„æ¨¡çš„çŸ›ç›¾ç°è±¡

| Seed | Phase 1 (ä¿å®ˆ) | Phase 1.5 (æ¿€è¿›) | åˆ†æ |
|:-----|---------------:|----------------:|:-----|
| 2027 | 36.11% âœ… | 30.30% âŒ | ä¿å®ˆå‚æ•°æ›´å¥½ |
| 2031 | 8.34% âŒ | 27.93% âœ… | æ¿€è¿›å‚æ•°æ›´å¥½ |
| 2034 | 30.35% âœ… | 4.45% âŒâŒâŒ | ä¿å®ˆå‚æ•°è¿œå¥½ |

**æ´å¯Ÿ**:
- 2/3çš„Large seedsåœ¨ä¿å®ˆå‚æ•°ä¸‹è¡¨ç°æ›´å¥½
- åªæœ‰Seed 2031ä¾‹å¤–ï¼ˆå¯èƒ½æ˜¯ç‰¹ä¾‹ï¼‰
- **Largeè§„æ¨¡åº”è¯¥ä½¿ç”¨æ›´ä¿å®ˆçš„å‚æ•°**

---

## ğŸ’¡ ç®—æ³•ä¼˜åŒ–æ–¹æ¡ˆ

### æ–¹æ¡ˆ1: è¶…ä¿å®ˆLargeå‚æ•° + ä¼˜åŒ–Medium â­â­â­â­â­ (å¼ºçƒˆæ¨è)

**æ ¸å¿ƒæ€æƒ³**: Largeè§„æ¨¡å›é€€åˆ°**æ¯”Phase 1æ›´ä¿å®ˆ**çš„å‚æ•°

#### æ–°å‚æ•°è®¾è®¡

**Smallè§„æ¨¡** (ä¿æŒPhase 1.5):
```python
alpha = 0.35
epsilon_min = 0.08
stagnation_ratio = 0.12
deep_stagnation_ratio = 0.30
```

**Mediumè§„æ¨¡** (ç»§ç»­ä¼˜åŒ–):
```python
alpha = 0.35              # â¬†ï¸ ä»0.30æé«˜åˆ°0.35
epsilon_min = 0.12        # ä¿æŒ
stagnation_ratio = 0.15   # â¬‡ï¸ ä»0.18é™ä½åˆ°0.15
deep_stagnation_ratio = 0.35
```

**Largeè§„æ¨¡** (è¶…ä¿å®ˆï¼Œæ¯”Phase 1æ›´ä¿å®ˆ):
```python
alpha = 0.12              # â¬‡ï¸ ä»Phase 1çš„0.15é™åˆ°0.12
epsilon_min = 0.15        # ä¿æŒ
stagnation_ratio = 0.40   # â¬†ï¸ ä»Phase 1çš„0.35å‡åˆ°0.40
deep_stagnation_ratio = 0.60
```

**ç†ç”±**:

1. **Largeè§„æ¨¡è¶…ä¿å®ˆå‚æ•°**:
   - alpha=0.12ï¼šæ›´æ…¢çš„å­¦ä¹ ï¼Œé¿å…Qå€¼éœ‡è¡
   - stagnation=0.40ï¼šç»™äºˆæ›´é•¿æ—¶é—´æ¢ç´¢ï¼Œé¿å…è¿‡æ—©stuck
   - è®©ç®—æ³•æ›´ä¾èµ–ALNSæ¢ç´¢ï¼Œè€Œä¸æ˜¯æ¿€è¿›çš„Q-learningæ›´æ–°

2. **Mediumè§„æ¨¡ç»§ç»­ä¼˜åŒ–**:
   - alpha=0.35ï¼šåŠ å¿«å­¦ä¹ ä»¥è¿½èµ¶Matheuristic
   - stagnation=0.15ï¼šæ›´æ—©ä½¿ç”¨LPä¿®å¤ï¼ˆMatheuristicçš„å¼ºé¡¹ï¼‰

3. **Smallè§„æ¨¡ä¿æŒç¨³å®š**:
   - å½“å‰è¡¨ç°å·²ç»ä¸é”™

---

### é¢„æœŸæ•ˆæœ

#### Largeè§„æ¨¡ï¼ˆå…³é”®æ”¹å–„ï¼‰:

| Seed | å½“å‰Phase 1.5 | é¢„æœŸæ”¹å–„ | ç›®æ ‡ |
|:-----|-------------:|----------:|:----:|
| 2027 | 30.30% | â†’ 35-36% | æ¥è¿‘Phase 1 |
| 2031 | 27.93% | â†’ 20-25% | å¯èƒ½ç•¥é™ä½†ç¨³å®š |
| 2034 | **4.45%** | â†’ **28-32%** | â­ å…³é”®æ¢å¤ |

**é‡ç‚¹**: é¿å…Seed 2034çš„ç¾éš¾æ€§å´©æºƒ

#### Mediumè§„æ¨¡ï¼ˆç»§ç»­æ”¹å–„ï¼‰:

| Seed | å½“å‰Phase 1.5 | é¢„æœŸæ”¹å–„ | ç›®æ ‡ |
|:-----|-------------:|----------:|:----:|
| 2027 | 36.50% | â†’ 40-42% | æ¥è¿‘Matheuristic 48% |
| 2031 | 40.12% | â†’ 44-46% | æ¥è¿‘Matheuristic 54% |
| 2034 | 38.00% | â†’ 38-40% | æ¥è¿‘Matheuristic 39% |

**é‡ç‚¹**: ç¼©å°ä¸Matheuristicçš„å·®è·

---

### æ–¹æ¡ˆ2: åŠ¨æ€stagnationé˜ˆå€¼ â­â­â­â­

**é—®é¢˜**: å›ºå®šçš„stagnation_ratioæ— æ³•é€‚åº”æ‰€æœ‰æƒ…å†µ

**æ”¹è¿›**: åŸºäºå½“å‰æ€§èƒ½åŠ¨æ€è°ƒæ•´stagnationé˜ˆå€¼

```python
def get_dynamic_stagnation_threshold(self, current_improvement, iterations):
    """åŠ¨æ€è®¡ç®—stagnationé˜ˆå€¼"""
    base_ratio = self._q_params.stagnation_ratio

    # å¦‚æœå½“å‰æ”¹è¿›å¾ˆå·®ï¼Œå»¶è¿Ÿè¿›å…¥stuckï¼ˆéœ€è¦æ›´å¤šæ¢ç´¢ï¼‰
    if current_improvement < 0.15:  # <15%æ”¹è¿›
        adjusted_ratio = base_ratio * 1.5  # å»¶è¿Ÿ50%

    # å¦‚æœå½“å‰æ”¹è¿›å¾ˆå¥½ï¼Œå¯ä»¥æ›´æ—©è¿›å…¥stuckï¼ˆåˆ©ç”¨LPï¼‰
    elif current_improvement > 0.35:  # >35%æ”¹è¿›
        adjusted_ratio = base_ratio * 0.8  # æå‰20%

    else:
        adjusted_ratio = base_ratio

    return int(iterations * adjusted_ratio)
```

**ä¼˜ç‚¹**:
- âœ… è‡ªé€‚åº”è°ƒæ•´ï¼Œé¿å…è¿‡æ—©æˆ–è¿‡æ™šstuck
- âœ… åŸºäºå®é™…æ€§èƒ½åé¦ˆ
- âœ… å®ç°ç®€å•

**ç¼ºç‚¹**:
- âš ï¸ éœ€è¦ä¿®æ”¹ä»£ç é€»è¾‘
- âš ï¸ éœ€è¦æµ‹è¯•éªŒè¯

**æ—¶é—´**: 1-2å¤©

---

### æ–¹æ¡ˆ3: ç®€åŒ–çŠ¶æ€æœº + å¢å¼ºLP â­â­â­

**é—®é¢˜**: ä¸‰æ€è®¾è®¡ï¼ˆexplore â†’ stuck â†’ deep_stuckï¼‰å¤ªå¤æ‚

**æ”¹è¿›**: ç®€åŒ–ä¸ºä¸¤é˜¶æ®µç­–ç•¥

```python
# å½“å‰ä¸‰æ€
explore (Q-learning) â†’ stuck (LP) â†’ deep_stuck (æ›´å¤šLP)

# ç®€åŒ–ä¸ºä¸¤é˜¶æ®µ
Phase 1: Pure Q-learning ALNS (50-60%è¿­ä»£)
Phase 2: Pure LP repair (40-50%è¿­ä»£)
```

**å…·ä½“è®¾è®¡**:
```python
def select_operators(self, iteration, max_iterations):
    threshold = max_iterations * 0.6  # 60%è¿­ä»£ååˆ‡æ¢

    if iteration < threshold:
        # Phase 1: çº¯Q-learning ALNS
        return self.q_learning_select()
    else:
        # Phase 2: çº¯LPä¿®å¤
        return self.lp_repair_select()
```

**ä¼˜ç‚¹**:
- âœ… ç®€å•æ˜ç¡®
- âœ… é¿å…stagnationåˆ¤æ–­çš„é—®é¢˜
- âœ… å……åˆ†åˆ©ç”¨LPä¿®å¤çš„ä¼˜åŠ¿

**ç¼ºç‚¹**:
- âš ï¸ å¤±å»äº†è‡ªé€‚åº”æ€§
- âš ï¸ å›ºå®šæ¯”ä¾‹å¯èƒ½ä¸æ˜¯æœ€ä¼˜

**æ—¶é—´**: 2-3å¤©

---

## ğŸ¯ æˆ‘çš„æ¨èå®æ–½è·¯å¾„

### Phase 1.5c: è¶…ä¿å®ˆLarge + ä¼˜åŒ–Medium (ç«‹å³å®æ–½)

**ä¸ºä»€ä¹ˆè¿™ä¸ªæ–¹æ¡ˆæœ€å¯è¡Œ**:

1. âœ… **å®ç°ç®€å•**: åªéœ€ä¿®æ”¹å‚æ•°å€¼
2. âœ… **æˆåŠŸæ¦‚ç‡é«˜**: åŸºäºæ•°æ®åˆ†æï¼Œæœ‰ç†è®ºæ”¯æ’‘
3. âœ… **å¿«é€ŸéªŒè¯**: 1-2å°æ—¶æµ‹è¯•å³å¯çœ‹åˆ°ç»“æœ
4. âœ… **ä½é£é™©**: ä¸æ”¹å˜ç®—æ³•ç»“æ„

**å®æ–½æ­¥éª¤**:

### ç¬¬1æ­¥: ä¿®æ”¹å‚æ•°ï¼ˆ30åˆ†é’Ÿï¼‰

ä¿®æ”¹ `src/planner/adaptive_params.py`:

```python
def _get_scale_adjustments(self, scale: ScaleType) -> dict:
    if scale == "small":
        return {
            "alpha": 0.35,
            "epsilon_min": 0.08,
            "stagnation_ratio": 0.12,
            "deep_stagnation_ratio": 0.30,
        }
    elif scale == "medium":
        return {
            "alpha": 0.35,              # â¬†ï¸ æé«˜
            "epsilon_min": 0.12,
            "stagnation_ratio": 0.15,   # â¬‡ï¸ é™ä½
            "deep_stagnation_ratio": 0.35,
        }
    else:  # large - è¶…ä¿å®ˆ
        return {
            "alpha": 0.12,              # â¬‡ï¸ æ¯”Phase 1æ›´ä½
            "epsilon_min": 0.15,
            "stagnation_ratio": 0.40,   # â¬†ï¸ æ¯”Phase 1æ›´é«˜
            "deep_stagnation_ratio": 0.60,
        }
```

### ç¬¬2æ­¥: éªŒè¯æµ‹è¯•ï¼ˆ1-2å°æ—¶ï¼‰

æµ‹è¯•å…³é”®seeds:
```bash
python scripts/generate_alns_visualization.py --seed 2027
python scripts/generate_alns_visualization.py --seed 2031
python scripts/generate_alns_visualization.py --seed 2034
```

**æˆåŠŸæ ‡å‡†**:
- âœ… Seed 2034 Largeæ¢å¤åˆ° >25%
- âœ… Seed 2027 Largeä¿æŒåœ¨ >33%
- âœ… Mediumè§„æ¨¡æ¥è¿‘Matheuristicï¼ˆå·®è·<8%ï¼‰

### ç¬¬3æ­¥: å¦‚æœæˆåŠŸï¼Œå®Œæ•´10-seedæµ‹è¯•

```powershell
for ($seed=2025; $seed -le 2034; $seed++) {
    python scripts/generate_alns_visualization.py --seed $seed
}
```

---

## ğŸ“Š å¦‚æœPhase 1.5cä»ç„¶ä¸ç†æƒ³

### Plan B: æ–¹æ¡ˆ2ï¼ˆåŠ¨æ€stagnationï¼‰

å®æ–½åŠ¨æ€é˜ˆå€¼è°ƒæ•´ï¼Œ1-2å¤©å®Œæˆ

### Plan C: æ–¹æ¡ˆ3ï¼ˆç®€åŒ–çŠ¶æ€æœºï¼‰

ç®€åŒ–ä¸ºä¸¤é˜¶æ®µç­–ç•¥ï¼Œ2-3å¤©å®Œæˆ

### Plan D: ç»„åˆæ–¹æ¡ˆ

Phase 1.5cå‚æ•° + åŠ¨æ€stagnationï¼Œ1å‘¨å®Œæˆ

---

## ğŸ’ª ä¸ºä»€ä¹ˆæˆ‘è®¤ä¸ºè¿™æ¬¡èƒ½æˆåŠŸ

### æ•°æ®æ”¯æ’‘

1. **Largeè§„æ¨¡Phase 1è¡¨ç°**:
   - Seed 2027: 36.11% (å¥½)
   - Seed 2034: 30.35% (å¯æ¥å—)
   - è¯´æ˜ä¿å®ˆå‚æ•°åœ¨Largeä¸Šæœ‰æ•ˆ

2. **Phase 1.5çš„æ•™è®­**:
   - æ¿€è¿›å‚æ•°ç ´åäº†Large
   - ä½†æ”¹å–„äº†Medium
   - è¯´æ˜éœ€è¦å·®å¼‚åŒ–å¯¹å¾…

3. **ç†è®ºä¾æ®**:
   - Largeé—®é¢˜æœç´¢ç©ºé—´å¤§ â†’ éœ€è¦æ…¢å­¦ä¹ 
   - Largeé—®é¢˜å®¹æ˜“éœ‡è¡ â†’ éœ€è¦ä½alpha
   - Largeé—®é¢˜éœ€è¦é•¿æ—¶é—´æ¢ç´¢ â†’ éœ€è¦æ™šstuck

### æ”¹è¿›ç­–ç•¥

**ä¸åŒäºä¹‹å‰çš„ç›²ç›®è°ƒå‚**:
- âœ… åŸºäºå¤±è´¥æ¡ˆä¾‹çš„æ·±åº¦åˆ†æ
- âœ… é’ˆå¯¹æ€§è§£å†³Seed 2034å´©æºƒ
- âœ… ä¿ç•™Mediumçš„æ”¹è¿›æ–¹å‘
- âœ… ç¨³å®šSmallçš„è¡¨ç°

---

## ğŸ¯ é¢„æœŸæœ€ç»ˆç»“æœ

### ä¹è§‚é¢„æœŸï¼ˆå¦‚æœPhase 1.5cæˆåŠŸï¼‰

**æ•´ä½“10-seedè¡¨ç°**:
- å¹³å‡å·®å¼‚: ç›®æ ‡ >5%
- tç»Ÿè®¡é‡: ç›®æ ‡ >2.045
- ç¾éš¾çº§å¤±è´¥: 0ä¸ª
- Largeè§„æ¨¡CV: <25%

**æŒ‰è§„æ¨¡**:
- Small: 38-42% (ç¨³å®š)
- Medium: 38-42% (æ”¹å–„ï¼Œæ¥è¿‘Matheuristic)
- Large: 25-32% (ç¨³å®šï¼Œæ— å´©æºƒ)

### ä¿å®ˆé¢„æœŸï¼ˆå¦‚æœéœ€è¦Plan B/Cï¼‰

**1å‘¨å†…å®Œæˆ**:
- åŠ¨æ€stagnationæˆ–ç®€åŒ–çŠ¶æ€æœº
- è·å¾—ç¨³å®šçš„æ”¹è¿›
- å³ä½¿æœªè¾¾åˆ°t>2.045ï¼Œä¹Ÿèƒ½æ¥è¿‘

---

## â° ç«‹å³è¡ŒåŠ¨

**æˆ‘å»ºè®®ç«‹å³å®æ–½Phase 1.5c**:

1. æˆ‘ä¿®æ”¹å‚æ•°ï¼ˆ30åˆ†é’Ÿï¼‰
2. æ¨é€åˆ°æ‚¨çš„åˆ†æ”¯
3. æ‚¨æµ‹è¯•Seeds 2027, 2031, 2034ï¼ˆ1-2å°æ—¶ï¼‰
4. æ ¹æ®ç»“æœå†³å®šï¼š
   - æˆåŠŸ â†’ å®Œæ•´10-seed
   - ä¸ç†æƒ³ â†’ Plan B/C

**å…³é”®ä¼˜åŠ¿**:
- âœ… å¿«é€Ÿï¼ˆå‡ å°æ—¶å³å¯éªŒè¯ï¼‰
- âœ… ä½é£é™©ï¼ˆåªæ”¹å‚æ•°ï¼‰
- âœ… æœ‰ç†è®ºæ”¯æ’‘ï¼ˆæ•°æ®åˆ†æï¼‰
- âœ… é’ˆå¯¹æ€§å¼ºï¼ˆè§£å†³Seed 2034å´©æºƒï¼‰

---

## ğŸ”§ å¦‚æœæ‚¨åŒæ„

**è¯·ç¡®è®¤**ï¼Œæˆ‘ä¼šç«‹å³ï¼š

1. ä¿®æ”¹ `adaptive_params.py` ä¸ºPhase 1.5cå‚æ•°
2. æ¨é€åˆ°æ‚¨çš„åˆ†æ”¯
3. æä¾›è¯¦ç»†çš„æµ‹è¯•è¯´æ˜
4. ç­‰å¾…æ‚¨çš„æµ‹è¯•ç»“æœ

**å¦‚æœæµ‹è¯•æˆåŠŸ**ï¼Œæˆ‘ä»¬å°†è·å¾—ï¼š
- âœ… ç¨³å®šçš„Largeè§„æ¨¡è¡¨ç°
- âœ… æ”¹å–„çš„Mediumè§„æ¨¡è¡¨ç°
- âœ… æ— ç¾éš¾æ€§å¤±è´¥
- âœ… å¯å‘è¡¨çš„æ­£å‘ç»“æœ

**è¿™æ˜¯æœ€æœ‰å¯èƒ½æˆåŠŸçš„å¿«é€Ÿæ–¹æ¡ˆï¼** ğŸ¯

---

**è¯·å‘Šè¯‰æˆ‘æ˜¯å¦ç«‹å³å®æ–½Phase 1.5cï¼Ÿ** æˆ‘å¯¹è¿™ä¸ªæ–¹æ¡ˆå¾ˆæœ‰ä¿¡å¿ƒï¼
